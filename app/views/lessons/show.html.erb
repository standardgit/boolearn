<% content_for :title do %>
    Boolearn \|
    <%= @course.title %>
<% end %>

<%= link_to 'Courses', courses_path %>/
<%= link_to course_path(@lesson.course) do %>
    <i class="fa fa-graduation-cap"></i>
    <%=  @lesson.course.title %>
<% end %>/
<%= link_to @lesson.title, course_lesson_path(@course, @lesson) %>
<p></p>
<div class="row">
    <div class="col-lg-8">
        <%= render 'lessons/lesson', lesson: @lesson %>
        <p></p>
    </div>
    <div class="col-lg-4">
        <ul class="list-group">
            <li class="list-group-item">
                <%= link_to course_path(@lesson.course) do %>
                    <i class="fa fa-graduation-cap"></i>
                    <%=  @lesson.course.title %>
                <% end %>
                <div class="float-right">
                    <i class="fa fa-spinner"></i>
                    <%= number_to_percentage(@course.progress(current_user), precision: 0) %>
                </div>
            </li>
        </ul>
        <ul class="group-list.lesson-sortable">
            <% @lessons.each do |lesson| %>
                <% if @lesson.present? && lesson == @lesson %>
                    <li class="list-group-item list-group-item-success">
                        <%= render 'lessons/lesson_preview', lesson: lesson %>
                    </li>
                <% else %>
                    <li class="list-group-item ">
                        <%= render 'lessons/lesson_preview', lesson: lesson %>
                    </li>
                <% end %>
            <% end %>
        </ul>
    </div>
</div>
<script>
    $(document).on('turbolinks:load', function() {
        $('.lesson-sortable').sortable({
            update: function(e, ui){
                let item = ui.item;
                let item_data = item.data();
                let params = {method: 'put'};
                params[item_data.modelName] = { row_order_position: item.index() }
                $.ajax({
                    type: 'POST',
                    url: item_data.updateUrl,
                    dataType: 'json',
                    data: params
                });
            },
            stop: function(e, ui){
                console.log("stop called when finishing sort of cards")
            }
        });
    });
</script>
